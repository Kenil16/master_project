<html><head>
<title>image_augmentation.py</title>
<meta name="Generator" content="htmlizer/[Twisted, version 17.9.0]" />
<link rel="alternate" href="image_augmentation.py" type="text/x-python" />

</head>
<body>
<pre><span class="py-src-keyword">import</span> <span class="py-src-variable">imgaug</span> <span class="py-src-keyword">as</span> <span class="py-src-variable">ia</span>
<span class="py-src-keyword">import</span> <span class="py-src-variable">imgaug</span>.<span class="py-src-variable">augmenters</span> <span class="py-src-keyword">as</span> <span class="py-src-variable">iaa</span>
<span class="py-src-keyword">from</span> <span class="py-src-variable">imgaug</span>.<span class="py-src-variable">augmentables</span>.<span class="py-src-variable">bbs</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">BoundingBox</span>, <span class="py-src-variable">BoundingBoxesOnImage</span>
<span class="py-src-keyword">import</span> <span class="py-src-variable">cv2</span> 

<span class="py-src-comment">#Inspriration taking from https://github.com/aleju/imgaug</span>
<span class="py-src-keyword">class</span> <span class="py-src-identifier">augmentation</span>:

    <span class="py-src-keyword">def</span> <span class="py-src-identifier">__init__</span>(<span class="py-src-parameter">self</span>):

        <span class="py-src-variable">self</span>.<span class="py-src-variable">sed</span> = <span class="py-src-variable">ia</span>.<span class="py-src-variable">seed</span>(<span class="py-src-number">1</span>)
        <span class="py-src-variable">self</span>.<span class="py-src-variable">sometimes</span> = <span class="py-src-keyword">lambda</span> <span class="py-src-variable">aug</span>: <span class="py-src-variable">iaa</span>.<span class="py-src-variable">Sometimes</span>(<span class="py-src-number">1.0</span>, <span class="py-src-variable">aug</span>)
        <span class="py-src-variable">self</span>.<span class="py-src-variable">seq</span> = <span class="py-src-variable">iaa</span>.<span class="py-src-variable">Sequential</span>(
                [
                
                <span class="py-src-comment">#Blur each image with varying strength using</span>
                <span class="py-src-comment">#Gaussian blur (sigma between 0 and 3.0),</span>
                <span class="py-src-comment">#Average/uniform blur (kernel size between 2x2 and 7x7)</span>
                <span class="py-src-comment">#Median blur (kernel size between 3x3 and 11x11).</span>
                <span class="py-src-variable">iaa</span>.<span class="py-src-variable">OneOf</span>([
                    <span class="py-src-variable">iaa</span>.<span class="py-src-variable">GaussianBlur</span>((<span class="py-src-number">0</span>, <span class="py-src-number">7.0</span>)),
                    <span class="py-src-variable">iaa</span>.<span class="py-src-variable">AverageBlur</span>(<span class="py-src-variable">k</span>=(<span class="py-src-number">1</span>, <span class="py-src-number">7</span>)),
                    <span class="py-src-variable">iaa</span>.<span class="py-src-variable">MedianBlur</span>(<span class="py-src-variable">k</span>=(<span class="py-src-number">1</span>, <span class="py-src-number">7</span>)),
                ]),
                
                <span class="py-src-variable">iaa</span>.<span class="py-src-variable">SomeOf</span>((<span class="py-src-number">0</span>, <span class="py-src-number">5</span>),
                    [
                        <span class="py-src-comment">#Add gaussian noise to some images.</span>
                        <span class="py-src-comment">#In 50% of these cases, the noise is randomly sampled per</span>
                        <span class="py-src-comment">#channel and pixel.</span>
                        <span class="py-src-comment">#In the other 50% of all cases it is sampled once per</span>
                        <span class="py-src-comment">#pixel (i.e. brightness change).</span>
                        <span class="py-src-variable">iaa</span>.<span class="py-src-variable">AdditiveGaussianNoise</span>(
                            <span class="py-src-variable">loc</span>=<span class="py-src-number">0</span>, <span class="py-src-variable">scale</span>=(<span class="py-src-number">0.0</span>, <span class="py-src-number">0.55</span>*<span class="py-src-number">255</span>), <span class="py-src-variable">per_channel</span>=<span class="py-src-number">0.5</span>
                        ),

                        <span class="py-src-variable">iaa</span>.<span class="py-src-variable">Rain</span>(<span class="py-src-variable">drop_size</span>=(<span class="py-src-number">0.10</span>, <span class="py-src-number">0.90</span>)),

                        <span class="py-src-comment">#Change brightness of images (50-150% of original value).</span>
                        <span class="py-src-variable">iaa</span>.<span class="py-src-variable">Multiply</span>((<span class="py-src-number">0.8</span>, <span class="py-src-number">1.5</span>), <span class="py-src-variable">per_channel</span>=<span class="py-src-number">0.5</span>),

                    ],
                    <span class="py-src-comment">#Do all of the above augmentations in random order</span>
                    <span class="py-src-variable">random_order</span>=<span class="py-src-variable">True</span>
                )
            ],
            <span class="py-src-variable">random_order</span>=<span class="py-src-variable">True</span>
        )

<span class="py-src-keyword">if</span> <span class="py-src-variable">__name__</span>==<span class="py-src-string">"__main__"</span>:
 
    <span class="py-src-variable">aug</span> = <span class="py-src-variable">augmentation</span>()

    <span class="py-src-variable">image</span> = <span class="py-src-variable">cv2</span>.<span class="py-src-variable">imread</span>(<span class="py-src-string">'aug_data/original_one_pattern_aruco.png'</span>)
    
    <span class="py-src-comment"># Augment BBs and images.</span>
    <span class="py-src-keyword">for</span> <span class="py-src-variable">i</span> <span class="py-src-keyword">in</span> <span class="py-src-variable">range</span>(<span class="py-src-number">2</span>):
        <span class="py-src-variable">image_aug</span> = <span class="py-src-variable">aug</span>.<span class="py-src-variable">seq</span>(<span class="py-src-variable">image</span>=<span class="py-src-variable">image</span>)
        <span class="py-src-variable">cv2</span>.<span class="py-src-variable">imwrite</span>(<span class="py-src-string">'aug_image'</span> + <span class="py-src-variable">str</span>(<span class="py-src-variable">i</span>) + <span class="py-src-string">'.png'</span>,<span class="py-src-variable">image_aug</span>)
</pre>
</body>